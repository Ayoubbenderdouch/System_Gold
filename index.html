<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø²Ù†Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ğŸ”’ Ø®Ø²Ù†Ø© Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø°Ù‡Ø¨</h1>
            <p class="subtitle">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ù…Ø´ÙØ±Ø©</p>
            
            <form id="loginForm">
                <div class="form-group">
                    <label for="masterPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</label>
                    <input 
                        type="password" 
                        id="masterPassword" 
                        name="masterPassword"
                        required 
                        autocomplete="current-password"
                        placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"
                    >
                </div>
                
                <div id="lockoutMessage" class="error-message" style="display: none;"></div>
                <div id="errorMessage" class="error-message" style="display: none;"></div>
                
                <button type="submit" id="loginButton" class="btn btn-primary">Ø¯Ø®ÙˆÙ„</button>
            </form>
            
            <div class="info-box">
                <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø© Ø£Ù…Ù†ÙŠØ©:</strong></p>
                <ul>
                    <li>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ø§ ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø£Ø¨Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù…</li>
                    <li>Ø¥Ø°Ø§ Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</li>
                    <li>ÙŠØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù…Ø¯Ø© 15 Ø¯Ù‚ÙŠÙ‚Ø© Ø¨Ø¹Ø¯ 5 Ù…Ø­Ø§ÙˆÙ„Ø§Øª ÙØ§Ø´Ù„Ø©</li>
                    <li>Ø§Ø­ØªÙØ¸ Ø¨Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø¯Ø§Ø¦Ù…Ø§Ù‹</li>
                </ul>
            </div>
        </div>
    </div>

    <script type="module">
        import { canEnterNow, registerAttempt, lockInfo } from './app.js';

        const form = document.getElementById('loginForm');
        const passwordInput = document.getElementById('masterPassword');
        const loginButton = document.getElementById('loginButton');
        const errorMessage = document.getElementById('errorMessage');
        const lockoutMessage = document.getElementById('lockoutMessage');

        // Check lockout status on load
        function updateLockoutUI() {
            const canEnter = canEnterNow();
            
            if (!canEnter) {
                const info = lockInfo();
                loginButton.disabled = true;
                passwordInput.disabled = true;
                lockoutMessage.style.display = 'block';
                lockoutMessage.textContent = `ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„. Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©: ${info.attempts}. Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${info.minutesLeft} Ø¯Ù‚ÙŠÙ‚Ø©.`;
                errorMessage.style.display = 'none';
                
                // Check again in 1 minute
                setTimeout(updateLockoutUI, 60000);
            } else {
                loginButton.disabled = false;
                passwordInput.disabled = false;
                lockoutMessage.style.display = 'none';
                
                const info = lockInfo();
                if (info.attempts > 0) {
                    errorMessage.style.display = 'block';
                    errorMessage.textContent = `ØªØ­Ø°ÙŠØ±: ${info.attempts} Ù…Ø­Ø§ÙˆÙ„Ø© ÙØ§Ø´Ù„Ø©. Ø³ÙŠØªÙ… Ø§Ù„Ù‚ÙÙ„ Ø¨Ø¹Ø¯ ${5 - info.attempts} Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©.`;
                }
            }
        }

        updateLockoutUI();

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!canEnterNow()) {
                return;
            }
            
            const password = passwordInput.value.trim();
            
            if (!password) {
                errorMessage.style.display = 'block';
                errorMessage.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±';
                return;
            }
            
            loginButton.disabled = true;
            loginButton.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...';
            errorMessage.style.display = 'none';
            
            try {
                // Simple validation - just check if Web Crypto API exists
                if (!window.crypto || !window.crypto.subtle) {
                    throw new Error('Web Crypto API not supported');
                }
                
                // Store password in sessionStorage
                sessionStorage.setItem('vault_pass', password);
                
                // Register successful attempt
                registerAttempt(true);
                
                // Redirect to sales page
                window.location.href = './sales.html';
                
            } catch (error) {
                console.error('Login error:', error.message);
                
                // Register failed attempt
                registerAttempt(false);
                
                // Update UI
                updateLockoutUI();
                
                if (canEnterNow()) {
                    errorMessage.style.display = 'block';
                    const info = lockInfo();
                    if (info.attempts === 0) {
                        errorMessage.textContent = 'ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
                    } else {
                        errorMessage.textContent = `ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©. Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ø§Ù„ÙØ§Ø´Ù„Ø©: ${info.attempts}/5`;
                    }
                }
                
                loginButton.disabled = false;
                loginButton.textContent = 'Ø¯Ø®ÙˆÙ„';
                passwordInput.value = '';
                passwordInput.focus();
            }
        });
    </script>
</body>
</html>
